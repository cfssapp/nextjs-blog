"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.defineRoutes = void 0;
const utils_1 = require("./utils");
function defineRoutes(callback) {
    const routes = Object.create(null);
    const parentRoutes = [];
    const defineRoute = (opts) => {
        opts.options = opts.options || {};
        const parentRoute = parentRoutes.length > 0 ? parentRoutes[parentRoutes.length - 1] : null;
        const parentId = parentRoute === null || parentRoute === void 0 ? void 0 : parentRoute.id;
        const parentAbsPath = parentRoute === null || parentRoute === void 0 ? void 0 : parentRoute.absPath;
        const absPath = [parentAbsPath, opts.path].join('/');
        const route = {
            path: opts.path || '/',
            id: (0, utils_1.createRouteId)(opts.file),
            parentId,
            file: opts.file,
            absPath,
        };
        routes[route.id] = route;
        if (opts.children) {
            parentRoutes.push(route);
            opts.children();
            parentRoutes.pop();
        }
    };
    callback(defineRoute);
    return routes;
}
exports.defineRoutes = defineRoutes;
