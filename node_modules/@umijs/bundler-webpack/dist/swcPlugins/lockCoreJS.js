"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const Visitor_1 = __importDefault(require("@swc/core/Visitor"));
const utils_1 = require("@umijs/utils");
const path_1 = require("path");
function addLastSlash(path) {
    return path.endsWith('/') ? path : `${path}/`;
}
class LockCoreJS extends Visitor_1.default {
    visitImportDeclaration(expression) {
        const { source } = expression;
        let { value, type } = source;
        if (type === 'StringLiteral' && value.startsWith('core-js/')) {
            value = value.replace(/^core-js\//, addLastSlash((0, utils_1.winPath)((0, path_1.dirname)(require.resolve('core-js/package.json')))));
            return Object.assign(Object.assign({}, expression), { source: Object.assign(Object.assign({}, source), { value }) });
        }
        return expression;
    }
}
exports.default = LockCoreJS;
